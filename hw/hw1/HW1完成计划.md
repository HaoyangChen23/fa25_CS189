# HW1 完成计划与分布策略

## 📋 作业概览

**总分数**: 81分（编程）+ 书面作业
- **Part 1** (`fashion_pt_1.ipynb`): 42分
- **Part 2** (`fashion_pt_2.ipynb`): 39分
- **书面作业** (`hw1_student.tex`): 独立提交

**截止日期**: 
- Part 1: Friday, September 19, 11:59 PM
- Part 2: Friday, September 26, 11:59 PM
- 书面作业: Friday, September 19, 11:59 PM

---

## 🎯 完成策略

### 阶段一：基础准备（2-3小时）

#### 1.1 环境设置
- [ ] 安装所有依赖 (`requirements.txt`)
- [ ] 熟悉 Jupyter Notebook 环境
- [ ] 下载 Fashion-MNIST 数据集
- [ ] 理解数据结构（28×28 灰度图像，10个类别）

#### 1.2 书面作业开始
- [ ] 阅读 `hw1_student.tex` 所有问题
- [ ] 标记需要复习的数学概念
- [ ] 可以先完成简单的计算题

---

### 阶段二：Part 1 - 数据处理与可视化（4-5小时）

#### 2.1 问题 0-1：pandas 基础（1小时）
**目标**: 熟悉数据操作

- [ ] **0a**: 创建 DataFrame（1分，自动评分）
  - 将图像和标签组织成 DataFrame
  - 确保图像列是 numpy 数组格式

- [ ] **1a**: 检查数据集平衡性（1分，自动评分）
  - 使用 `value_counts()` 统计各类别数量

- [ ] **1b**: 使用 `groupby()` 分组（1分，自动评分）
  - 按标签分组并计算统计信息

- [ ] **1c**: 可视化标签分布（1分，手动评分）
  - 使用 pandas 的 `plot()` 创建直方图
  - 确保图表清晰标注

- [ ] **1d**: 可视化类别示例（1分，自动评分）
  - 使用提供的 `show_images()` 函数
  - 展示每个类别的样本图像

**检查点**: 运行所有 autograder 检查，确保通过

---

#### 2.2 问题 2：聚类分析（1-1.5小时）
**目标**: 理解数据结构

- [ ] **2a**: K-means 聚类（2分，自动评分）
  - 将图像展平为 784 维向量
  - 应用 K-means 聚类（k=10）
  - 理解聚类结果

- [ ] **2b**: 评估聚类（1分，自动评分）
  - 计算聚类中心
  - 分析聚类质量

- [ ] **2c**: 可视化聚类（1分，手动评分）
  - 展示聚类中心图像
  - 可视化聚类结果

- [ ] **2d**: 观察聚类模式（2分，手动评分）
  - 分析聚类与真实标签的关系
  - 思考为什么某些类别容易被混淆

**检查点**: 理解聚类结果，为后续分类做准备

---

#### 2.3 问题 3：训练分类器（2-2.5小时）
**目标**: 建立第一个 ML 模型

- [ ] **3a**: 训练 MLP 分类器（2分，自动评分）
  - 数据归一化（缩放到 [0,1]）
  - 使用 MLPClassifier（参考 lecture 3）
  - 绘制损失曲线
  - **重要**: 设置 `random_state=SEED`

- [ ] **3b**: 添加预测和评估（2分，自动评分）
  - 在 DataFrame 中添加预测列
  - 计算准确率
  - 标记正确/错误的预测

- [ ] **3c**: 类别准确率分析（1分，自动评分）
  - 计算每个类别的准确率
  - 可视化类别性能

- [ ] **3d**: 最好/最差类别（2分，手动评分）
  - 分析哪些类别表现好/差
  - 提供解释

- [ ] **3e**: 创建混淆矩阵（2分，自动评分）
  - 使用 `confusion_matrix` 函数
  - 可视化混淆矩阵

- [ ] **3f**: 分析预测置信度（1分，自动评分）
  - 使用 `predict_proba()` 获取概率
  - 分析置信度分布

- [ ] **3g**: 调查 "Ankle boot" 混淆（1分，自动评分）
  - 找出被误分类为其他类别的样本
  - 可视化这些样本

- [ ] **3h**: "Ankle boot" 低置信度原因（1分，手动评分）
  - 分析为什么这个类别置信度低

- [ ] **3i**: 调查 "Trouser" 混淆（1分，自动评分）
  - 类似 3g，但针对 "Trouser"

- [ ] **3j**: "Trouser" 高置信度原因（1分，手动评分）
  - 分析为什么这个类别置信度高

**检查点**: 
- 确保模型训练成功
- 保存模型（设置 `save_models=True`）
- 理解模型性能

---

#### 2.4 问题 4：图像变换（2-3小时）
**目标**: 理解线性变换和图像增强

- [ ] **4a**: 水平翻转（1分，自动评分）
  - 构建水平翻转变换矩阵
  - 应用变换并验证
  - **参考**: `public_solutions/horizontal_flip_image.npy`

- [ ] **4b**: 图像平移（2分，自动评分）
  - 实现上下左右平移
  - 构建平移变换矩阵
  - **参考**: `public_solutions/shift_*.npy`

- [ ] **4c**: 图像模糊（2分，自动评分）
  - 实现卷积模糊操作
  - 支持不同大小的模糊核（3×3, 5×5）
  - **参考**: `public_solutions/blur_*.npy`

- [ ] **4d**: 图像旋转（2分，自动评分）
  - 实现旋转变换矩阵
  - 支持不同角度（45°, 90°, 200°, 270°）
  - **参考**: `public_solutions/rotate_*.npy`

- [ ] **4e**: 双线性插值旋转（2分，自动评分）
  - 实现带双线性插值的旋转
  - 理解插值的重要性
  - **参考**: `public_solutions/rotate_*_bilinear*.npy`

- [ ] **4f**: 组合变换（1分，自动评分）
  - 组合多个变换（如：平移→旋转→模糊）
  - 理解矩阵乘法的顺序
  - **参考**: `public_solutions/*_then_*.npy`

- [ ] **4g**: 矩阵乘法问题（2分，手动评分）
  - 回答关于变换组合的理论问题

- [ ] **4h**: 增强测试图像（1分，自动评分）
  - 对测试集应用变换
  - 准备增强数据

- [ ] **4i**: 评估增强数据性能（2分，自动评分）
  - 在增强数据上测试分类器
  - 比较性能变化

- [ ] **4j**: 增强技术分析（2分，手动评分）
  - 分析哪些增强技术最有效
  - 解释原因

**检查点**: 
- 所有变换矩阵正确实现
- 可以使用 `test_image.npy` 验证
- 理解变换对模型性能的影响

**提示**: 
- 变换矩阵大小：784×784（28×28 图像展平后）
- 注意矩阵乘法的顺序
- 参考 `public_solutions/` 中的答案文件

---

### 阶段三：Part 2 - 高级主题（5-6小时）

#### 3.1 问题 5：回归分析（1.5-2小时）
**目标**: 从分类转向回归

- [ ] **5a**: 训练线性回归模型（2分，自动评分）
  - 加载价格数据 (`FashionMNIST_prices.csv`)
  - 使用 `join()` 合并数据
  - 训练 `LinearRegression` 模型
  - **重要**: 模型命名为 `price_model`
  - 确保预测价格为正数

- [ ] **5b**: 评估回归性能（4分，自动评分）
  - 实现 `compute_rmse()`（均方根误差）
  - 实现 `compute_mae()`（平均绝对误差）
  - 实现 `compute_r2()`（R² 分数）
  - 可视化预测 vs 实际价格

- [ ] **5c**: MAE、MSE、R² 比较（1分，手动评分）
  - 解释各指标的优缺点

- [ ] **5d**: 分类与回归错误关系（2分，手动评分）
  - 计算分类错误样本的价格预测误差
  - 比较正确分类 vs 错误分类的价格误差

**检查点**: 
- 回归模型训练成功
- 保存 `price_model.joblib`
- 理解回归指标

---

#### 3.2 问题 6：处理分布偏移（1-1.5小时）
**目标**: 理解测试集分布不匹配

- [ ] **6a**: 秘密测试集推理（3分，自动评分）
  - 加载 `secret_test_set/`
  - 使用 `scaler.transform()` 预处理
  - 使用 `model` 预测标签
  - 创建 `test_secret_df` DataFrame

- [ ] **6b**: 类别准确率比较（2分，手动评分）
  - 绘制原始测试集 vs 秘密测试集的类别准确率
  - 使用双色柱状图

- [ ] **6c**: 混淆矩阵（1分，自动评分）
  - 生成秘密测试集的混淆矩阵
  - 分析错误模式

- [ ] **6d**: 分析分布偏移（1分，手动评分）
  - 观察异常模式
  - 推测测试集特点

**检查点**: 
- 发现测试集图像被旋转
- 理解为什么性能下降

---

#### 3.3 问题 7：解决方案 1 - 数据增强（1-1.5小时）
**目标**: 训练旋转不变模型

- [ ] **7a**: 生成旋转训练数据（3分，自动评分）
  - 实现 `randomly_rotate_images()` 函数
  - 对每张图像生成多个随机旋转
  - 返回增强数据和标签

- [ ] **7b**: 训练旋转不变分类器（3分，手动评分）
  - 在旋转数据上训练新模型
  - 模型命名为 `model_rotated`
  - 设置 `random_state=42`
  - 绘制损失曲线
  - 保存 `mlp_fashionmnist_rotated_model.joblib`

**检查点**: 
- 模型在秘密测试集上性能提升
- 理解数据增强的作用

---

#### 3.4 问题 8：解决方案 2 - 旋转校正（2-2.5小时）
**目标**: 预测并校正旋转

- [ ] **8a**: 预测旋转角度（3分，手动评分）
  - 训练 `MLPRegressor` 预测旋转角度
  - 模型命名为 `model_rotation_regression`
  - 设置 `random_state=42`
  - 使用提供的超参数
  - 保存 `model_rotation_regression.joblib`

- [ ] **8b**: 评估角度预测（3分，自动评分）
  - 计算 MSE 和 RMSE
  - 可视化预测 vs 实际角度
  - 展示反旋转示例

- [ ] **8c**: 反旋转并评估（5分，自动评分）
  - 预测秘密测试集的旋转角度
  - 反旋转图像（使用 `-predicted_angle`）
  - 在反旋转图像上评估原始分类器
  - 添加 `unrotated_prediction` 和 `unrotated_correct` 列

- [ ] **8d**: 比较两种方案（1分，手动评分）
  - 分析为什么方案2可能不如方案1

**检查点**: 
- 理解回归模型的局限性
- 比较不同解决方案的效果

---

#### 3.5 问题 9：解决方案 3 - 测试时增强（1-2小时）
**目标**: 实现 TTA 达到 ≥58% 准确率

- [ ] **9a**: 实现测试时增强（5分，自动评分）
  - 实现 `test_time_augmentation()` 函数
  - 可以使用 `model_rotation_regression`
  - 可以多次推理
  - 聚合多个增强版本的预测
  - **目标**: 准确率 ≥58%

**策略建议**:
1. 预测旋转角度并反旋转
2. 生成多个旋转版本（如 0°, 90°, 180°, 270°）
3. 对每个版本预测，然后投票
4. 或者：预测角度后，生成多个接近该角度的版本

**检查点**: 
- 准确率 ≥58%
- 理解 TTA 的工作原理

---

### 阶段四：书面作业（3-4小时）

#### 4.1 线性代数部分（1.5小时）
- [ ] 问题 1: 方程组求解（3分）
- [ ] 问题 2: 矩阵渐近幂（6分）
- [ ] 问题 3: SVD（4分）
- [ ] 问题 4: 图像翻转变换矩阵（6分）

#### 4.2 微积分部分（1小时）
- [ ] 问题 5: 偏导数（8分）
- [ ] 问题 6: 递归表达式和导数（6分）

#### 4.3 概率部分（1小时）
- [ ] 问题 7: 条件均匀差（3分）
- [ ] 问题 8: 最近邻弧长（4分）
- [ ] 问题 9: 癌症筛查（3分）
- [ ] 问题 10: 关注者数量（3分）

---

### 阶段五：最终检查与提交（1小时）

#### 5.1 代码检查
- [ ] 运行所有 autograder 检查
- [ ] 确保所有自动评分题目通过
- [ ] 检查手动评分题目的答案完整性

#### 5.2 模型保存
- [ ] 设置 `save_models=True`
- [ ] 设置 `load_saved_models=True`
- [ ] 确认以下文件存在：
  - `mlp_fashionmnist_model.joblib`
  - `price_model.joblib`
  - `mlp_fashionmnist_rotated_model.joblib`
  - `model_rotation_regression.joblib`
  - `scaler.joblib`（如果需要）

#### 5.3 提交准备
- [ ] Part 1: 导出 notebook 为 PDF/HTML
- [ ] Part 2: 导出 notebook 并包含所有模型文件
- [ ] 书面作业: 编译 LaTeX 为 PDF
- [ ] 检查文件大小和格式
- [ ] 提前几小时提交，避免最后时刻问题

---

## 📊 时间分配建议

| 阶段 | 预计时间 | 优先级 |
|------|---------|--------|
| 环境设置 | 2-3小时 | 高 |
| Part 1 (问题 0-1) | 1小时 | 高 |
| Part 1 (问题 2) | 1-1.5小时 | 中 |
| Part 1 (问题 3) | 2-2.5小时 | 高 |
| Part 1 (问题 4) | 2-3小时 | 高 |
| Part 2 (问题 5) | 1.5-2小时 | 高 |
| Part 2 (问题 6) | 1-1.5小时 | 高 |
| Part 2 (问题 7) | 1-1.5小时 | 高 |
| Part 2 (问题 8) | 2-2.5小时 | 高 |
| Part 2 (问题 9) | 1-2小时 | 高 |
| 书面作业 | 3-4小时 | 高 |
| 最终检查 | 1小时 | 高 |
| **总计** | **18-25小时** | |

---

## 🎓 学习重点

### 核心概念
1. **pandas DataFrame 操作**
   - `groupby()`, `apply()`, `join()`
   - 数据筛选和聚合

2. **图像变换**
   - 线性变换矩阵（784×784）
   - 矩阵乘法顺序
   - 双线性插值

3. **机器学习流程**
   - 数据预处理（标准化）
   - 模型训练和评估
   - 超参数设置

4. **分布偏移**
   - 训练/测试分布不匹配
   - 数据增强
   - 测试时增强（TTA）

5. **回归 vs 分类**
   - 回归指标（RMSE, MAE, R²）
   - 分类指标（准确率, 混淆矩阵）

### 常见陷阱
1. ❌ 忘记设置 `random_state`
2. ❌ 忘记保存模型文件
3. ❌ 变换矩阵顺序错误
4. ❌ 数据预处理不一致（训练 vs 测试）
5. ❌ 手动评分题目答案不完整

---

## 📝 每日进度追踪

### Day 1: 基础设置 + Part 1 前半
- [ ] 环境设置
- [ ] 问题 0-1 完成
- [ ] 问题 2 完成

### Day 2: Part 1 后半
- [ ] 问题 3 完成
- [ ] 问题 4 开始

### Day 3: Part 1 完成 + Part 2 开始
- [ ] 问题 4 完成
- [ ] Part 1 检查
- [ ] 问题 5 完成

### Day 4: Part 2 核心
- [ ] 问题 6 完成
- [ ] 问题 7 完成
- [ ] 问题 8 开始

### Day 5: Part 2 完成
- [ ] 问题 8 完成
- [ ] 问题 9 完成
- [ ] Part 2 检查

### Day 6: 书面作业
- [ ] 线性代数部分
- [ ] 微积分部分
- [ ] 概率部分

### Day 7: 最终检查
- [ ] 所有代码检查
- [ ] 所有模型保存
- [ ] 提交所有作业

---

## 🔗 有用资源

### 文档
- [pandas 文档](https://pandas.pydata.org/docs/)
- [scikit-learn 文档](https://scikit-learn.org/stable/)
- [plotly 文档](https://plotly.com/python/)
- [numpy 文档](https://numpy.org/doc/)

### 参考文件
- `public_solutions/`: 变换矩阵的参考答案
- `test_image.npy`: 用于测试变换的图像
- Lecture 3 notebook: MLP 分类器示例

### 调试技巧
1. 使用 `test_image.npy` 验证变换矩阵
2. 可视化中间结果
3. 检查数据形状和类型
4. 使用 `grader.check()` 及时验证

---

## ✅ 完成检查清单

### Part 1 检查清单
- [ ] 所有自动评分题目通过
- [ ] 所有手动评分题目有完整答案
- [ ] 模型保存成功
- [ ] 所有可视化清晰
- [ ] 代码有适当注释

### Part 2 检查清单
- [ ] 所有模型文件存在
- [ ] 回归模型准确预测价格
- [ ] 旋转模型在秘密测试集上性能提升
- [ ] TTA 达到 ≥58% 准确率
- [ ] 所有手动评分题目有完整答案

### 书面作业检查清单
- [ ] 所有问题都有答案
- [ ] 数学推导清晰
- [ ] LaTeX 编译成功
- [ ] PDF 格式正确

---

## 💡 提示与建议

1. **尽早开始**: 不要等到截止日期前才开始
2. **分阶段完成**: 按计划逐步完成，不要一次性做太多
3. **及时测试**: 每完成一个问题就运行 autograder
4. **保存模型**: 训练好的模型要保存，避免重复训练
5. **理解概念**: 不要只是复制代码，要理解为什么这样做
6. **寻求帮助**: 遇到困难及时询问助教或同学
7. **提前提交**: 至少提前几小时提交，避免技术问题

---

**祝你好运！加油！🚀**
